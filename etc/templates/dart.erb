<% if header? %>
// <%= FFIDB.header %>

<% end %>
import 'dart:ffi';
import 'dart:io' as io;

final <%= @library.name %> = DynamicLibrary.open('<%= @soname %>');
<% for enum in @enums || [] %>

<% if enum.comment %>
/// <%= enum.comment %>
<% end %>
abstract class <%= enum.name %> {
  <%= enum.name %>._();

  <% for name, value in enum.values || {} %>
  static const <%= name %> = <%= value %>;
  <% end %>
}
<% end %>
<% for struct in @structs || [] %>

<% if struct.comment %>
/// <%= struct.comment %>
<% end %>
class <%= struct.name %> extends Struct {
  <% for (name, type), i in (struct.fields || {}).each_with_index %>
<%= i.zero? ? '' : "\n" -%>
    <% unless type.pointer? %>
    @<%= format_ffi_type(type) %>() // <%= type %>
    <% else %>
    // <%= type %>
    <% end %>
    <%= format_dart_type(type) %> <%= name %>;
  <% end %>
}
<% end %>
<% for function in @functions || [] %>

<% if function.comment %>
/// <%= function.comment %>
<% end %>
final <%= format_dart_type(function.type) %> Function(<%=
      function.parameters.each_value.map { |p| format_dart_type(p.type) }.join(', ')
    %>) <%= function.name %> = <%= @library.name %>
    .lookup<NativeFunction<<%= format_ffi_type(function.type) %> Function(<%=
      function.parameters.each_value.map { |p| format_ffi_type(p.type) }.join(', ')
    %>)>>('<%= function.name %>')
    .asFunction();
<% end %>
